"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var modal,loader;jQuery(function(e){e(document.body).on("updated_shipping_method",function(){set_wms_mondial_relay_pickup_modal()}).on("updated_wc_div",function(){set_wms_mondial_relay_pickup_modal()}).on("updated_checkout",function(){set_wms_mondial_relay_pickup_modal()})});var __=wp.i18n.__,sprintf=wp.i18n.sprintf;function getSelectedShippingMethod(){var e,t=null===(e=document.getElementsByClassName("wc-block-components-shipping-rates-control__package")[0])||void 0===e||null===(e=e.getElementsByClassName("wc-block-components-radio-control__option-checked")[0])||void 0===e||null===(e=e.firstChild)||void 0===e?void 0:e.value;if(t)return t;var n=document.querySelector('input[name^="shipping_method"]:checked');if(n)return n.value;var o=document.querySelector('input[name="wms_shipping_method_to_select"]:checked');return o?o.value:null}function getUserAddress(e){var t,n,o,r,i={zipcode:"",country:"FR"},c=document.getElementById("shipping_postcode"),l=document.getElementById("billing_postcode"),d=document.getElementById("shipping-postcode"),a=document.getElementById("billing-postcode");c&&e?i.zipcode=c.value:l?i.zipcode=l.value:d?i.zipcode=d.value:a&&(i.zipcode=a.value);var u=document.getElementById("shipping_country"),s=document.getElementById("billing_country"),p=null!==(t=null===(n=document.getElementById("shipping-country"))||void 0===n?void 0:n.querySelector("input"))&&void 0!==t?t:document.getElementById("shipping-country"),m=null!==(o=null===(r=document.getElementById("billing-country"))||void 0===r?void 0:r.querySelector("input"))&&void 0!==o?o:document.getElementById("billing-country");return u&&e?i.country=u.value:s?i.country=s.value:p?i.country=p.value||p:m&&(i.country=m.value||m),i}function set_wms_mondial_relay_pickup_modal(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wms_pickup_open_modal_mondial_relay",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementsByClassName(e);if(0!==n.length){var o,r=_createForOfIteratorHelper(n);try{for(r.s();!(o=r.n()).done;){var i=o.value;null==i.getAttribute("wms-backbone-set")&&(i.addEventListener("click",function(e){e.preventDefault(),jQuery(this).WCBackboneModal({template:0<t.length?t:this.getAttribute("wms-pickup-modal-id")}),modal=document.getElementById(0<t.length?t:this.getAttribute("wms-pickup-modal-id")),loader=modal.querySelector(".wc-backbone-modal-loader"),init_mondial_relay_map()}),i.setAttribute("wms-backbone-set",!0))}}catch(e){r.e(e)}finally{r.f()}}}function init_mondial_relay_map(){var e,t,n,o,r,i,c,l=getUserAddress((null===(e=document.getElementById("ship-to-different-address-checkbox"))||void 0===e?void 0:e.checked)||!1),d=l.zipcode&&"75001"!==l.zipcode?l.zipcode:"75001",a=l.country||"FR",u=getSelectedShippingMethod(),s="string"==typeof u&&u.includes("mondial_relay_lockers");console.log(s),jQuery(".wms_pickup_modal_map").MR_ParcelShopPicker({Target:"#wms_pickup_point",Brand:"CC21X9MZ",Country:a,PostCode:d,Responsive:!0,NbResults:19,ColLivMod:s?"APM":"",OnParcelShopSelected:function(e){t=e.ID,n=e.Nom,o=e.Adresse1,r=e.CP,i=e.Ville,c=e.Pays;var l=document.getElementById("wms_pickup_point");l&&(l.value=t),updateSelectedPickupInfo(e)}}),jQuery("#wms_select_point").on("click",function(){if(null!=n){var e=[n,o,i+" "+r,c],l=jQuery("#wms_ajax_error"),d=jQuery("#wms_pickup_selected"),a=jQuery("#wms_shipping_provider").val(),u=jQuery("#wms_nonce").val();confirm(sprintf(__("Merci de confirmer votre choix: %s","wc-multishipping"),"\n\n"+e.join("\n")))&&jQuery.ajax({url:WMS.ajaxurl,type:"POST",dataType:"json",data:{action:"wms_select_pickup_point",pickup_id:t,pickup_name:n,pickup_address:o,pickup_zipcode:r,pickup_city:i,pickup_country:c,pickup_provider:a,wms_nonce:u},beforeSend:function(){l.hide()},success:function(t){if(!1===t.error){d.html("<div>"+e.join("</div><div>")+"</div>"),jQuery("#wms_pickup_info").val(JSON.stringify(e)),modal.querySelector(".modal-close").click();var n,o=_createForOfIteratorHelper(jQuery(".wc-block-components-shipping-address"));try{for(o.s();!(n=o.n()).done;){var r=n.value;-1!=jQuery(r).html().indexOf("Livraison à")&&jQuery(r).html("Livraison à : "+e.join("\n"))}}catch(e){o.e(e)}finally{o.f()}jQuery("body").trigger("update_checkout")}else l.html(t.error_message),l.show()}})}else modal.querySelector(".modal-close").click()})}function updateSelectedPickupInfo(e){var t=document.getElementById("wms_mondial_relay_selected_info"),n=document.getElementById("wms_select_point");if(t&&e){t.classList.remove("wms_selected_info_empty"),t.classList.add("wms_selected_info_filled");var o='\n        <div class="wms_selected_name">'.concat(e.Nom||"",'</div>\n        <div class="wms_selected_address">').concat(e.Adresse1||"","</div>\n        ").concat(e.Adresse2?'<div class="wms_selected_address">'.concat(e.Adresse2,"</div>"):"",'\n        <div class="wms_selected_city">').concat(e.CP||""," ").concat(e.Ville||"",'</div>\n        <div class="wms_selected_country">').concat(e.Pays||"",'</div>\n        <div class="wms_selected_id">ID: ').concat(e.ID||"","</div>\n    ");t.innerHTML=o,n&&(n.disabled=!1)}}jQuery(function(e){set_wms_mondial_relay_pickup_modal()});